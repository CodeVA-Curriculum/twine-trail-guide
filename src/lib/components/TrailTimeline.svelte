<script>
    import LocationNode from '$lib/components/LocationNode.svelte';
    // import { locations } from '$lib/db/trails';
    import { onMount } from 'svelte';
    import {locations, selected} from '$lib/util/stores.js'
    import { object_without_properties } from 'svelte/internal';
    export let mobile = "false"

    let locNodes = []
    onMount(() => {
        // locations.set([])
        locations.subscribe(locs => {
            locNodes = []
            let count = 0
            for(let i=0;i<locs.length;i++) {
                let node = {}
                if(!locs[i].optional) {
                    count+=1;
                }
                node = {
                    slug: locs[i].slug,
                    optional: locs[i].optional,
                    index: count
                }
                locNodes = [...locNodes, node]
            }
        })
        return () => {
            // console.log("Unmounting timeline...")
            // clear timeline
            locations.set([])
        }
    })

    // $: console.log(`Timeline sees ${$locations.length} locations in the store.`)

</script>

<section class="timeline my-5">
    <!-- <h2 class='title is-size-4'>Trail Blazes</h2> -->
    <header class="timeline-header">
        <span class="tag is-medium is-primary">Start</span>
    </header>
    
    {#each locNodes as obj, i}
    <!-- <LocationNode 
        cl={() => console.log("click!")}
        title={$locationData[path].title}
        short={$locationData[path].short}
        position={1}
        type={$locationData[path].type}
        slug={path}
        selected={false}
    /> -->
    <LocationNode
        position={obj.index}
        slug={obj.slug}
        optional={obj.optional}
    />
    {/each}
    
    <div class="timeline-header">
        <span class="tag is-medium is-primary">End</span>
    </div>
</section>

<style>
    @media (min-width: 1024px) { 
        .timeline {
            position: absolute;
            top: 0;
            left: 41rem;
            padding-left: auto;
            padding-right: 0;
        }
     }
     @media (max-width: 1023px) { 
        .timeline {
            position: relative;
            top: 0;
            left: 0;
        }
     }
    
</style>

